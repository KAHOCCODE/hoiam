<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>H·ªìi‚ÄØ√Çm‚ÄØƒêam‚ÄØM·ªπ - V≈© Tr·ª• Truy·ªán</title>
<link rel="icon" type="image/x-icon" href="favicon.ico">

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap');
  body{font-family:'Quicksand',sans-serif;color:#222;overflow-x:hidden;margin:0; background: #0f0c29;}

  /* --- CANVAS N·ªÄN --- */
  canvas#stars{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-10;display:block;}

  /* --- HI·ªÜU ·ª®NG K√çNH (ƒê√£ t·ªëi ∆∞u blur nh·∫π) --- */
  .glass {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border: 1px solid rgba(255, 255, 255, 0.6);
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  }

  /* --- TEXT M√ÄU --- */
  .text-shimmer {
    background: linear-gradient(to right, #667eea 0%, #764ba2 40%, #ff7eb3 50%, #764ba2 60%, #667eea 100%);
    background-size: 200% auto;
    color: #000;
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: shine 5s linear infinite;
    font-weight: 800;
  }
  @keyframes shine { to { background-position: 200% center; } }

  /* --- BUTTON --- */
  .btn-gradient {
    background-size: 200% auto;
    background-image: linear-gradient(to right, #667eea 0%, #764ba2 51%, #667eea 100%);
    color: #fff; border: none; border-radius: 30px;
    transition: 0.3s;
    box-shadow: 0 4px 10px rgba(118, 75, 162, 0.3);
  }
  .btn-gradient:hover { background-position: right center; color: #fff; transform: translateY(-2px); box-shadow: 0 6px 15px rgba(118, 75, 162, 0.5); }

  /* --- ANIMATION NH·ªé --- */
  .floating-deco { animation: float 6s ease-in-out infinite; }
  @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-6px); } 100% { transform: translateY(0px); } }

  .vinyl-record {
    width: 35px; height: 35px; border-radius: 50%;
    background: repeating-radial-gradient(#111 0, #111 2px, #333 3px, #333 4px);
    position: relative; border: 2px solid #fff;
    animation: vinyl-spin 10s linear infinite;
  }
  .vinyl-record::after {content:'';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:10px;height:10px;background:radial-gradient(circle, #ff5f6d, #ffc371);border-radius:50%;}
  @keyframes vinyl-spin {from{transform:rotate(0deg);}to{transform:rotate(360deg);}}

  .loader {width: 40px;height: 40px;border: 4px solid #FFF;border-bottom-color: #764ba2;border-radius: 50%;display: inline-block;box-sizing: border-box;animation: rotation 1s linear infinite; margin: 20px auto;}
  @keyframes rotation {0% {transform: rotate(0deg);}100% {transform: rotate(360deg);}}
</style>
</head>

<body>

<canvas id="stars"></canvas>
<script>
const c=document.getElementById("stars"),x=c.getContext("2d");
function resize(){c.width=innerWidth;c.height=innerHeight;}window.onresize=resize;resize();
class Star{
  constructor(){this.reset();}
  reset(){this.x=Math.random()*c.width;this.y=Math.random()*c.height;this.r=Math.random()*1.2;this.dx=(Math.random()-.5)*0.1;this.dy=(Math.random()-.5)*0.1;this.opacity=Math.random();}
  draw(){
    x.beginPath();x.arc(this.x,this.y,this.r,0,Math.PI*2);
    x.fillStyle=`rgba(255, 255, 255, ${this.opacity})`;x.fill();
  }
  update(){
    this.x+=this.dx;this.y+=this.dy;
    if(this.x<0||this.x>c.width)this.x=Math.random()*c.width;
    if(this.y<0||this.y>c.height)this.y=Math.random()*c.height;
    this.draw();
  }
}
const starsArray=[...Array(80)].map(()=>new Star());
function animate(){
  x.clearRect(0,0,c.width,c.height);
  const g=x.createLinearGradient(0,0,0,c.height);g.addColorStop(0,"#0f0c29");g.addColorStop(1,"#24243e");
  x.fillStyle=g;x.fillRect(0,0,c.width,c.height);
  starsArray.forEach(s=>s.update());
  requestAnimationFrame(animate);
}animate();
</script>

<nav class="fixed w-full backdrop-blur-md bg-white/80 shadow-sm z-50 transition-all duration-300 border-b border-white/20 h-16">
  <div class="max-w-7xl mx-auto flex items-center justify-between px-4 h-full">
    <a href="#home" class="text-xl font-bold flex items-center gap-3 group">
      <div class="vinyl-record"></div> 
      <span class="text-shimmer text-lg sm:text-xl">H·ªìi‚ÄØ√Çm‚ÄØƒêam‚ÄØM·ªπ</span>
    </a>
    <button id="menuBtn" class="sm:hidden text-xl text-indigo-700 focus:outline-none"><i class="fa-solid fa-bars"></i></button>
    <div id="navLinks" class="hidden sm:flex flex-col sm:flex-row sm:items-center sm:space-x-4 absolute sm:static w-full sm:w-auto bg-white sm:bg-transparent left-0 top-16 sm:top-auto shadow-lg sm:shadow-none text-gray-700 text-sm font-bold p-4 sm:p-0 border-b sm:border-0 border-gray-100">
      <a href="#suggest" class="block py-2 px-3 rounded-lg hover:bg-indigo-50 hover:text-indigo-600 transition"><i class="fa-solid fa-pen-nib mr-1 text-indigo-500"></i> ƒê·ªÅ‚ÄØxu·∫•t</a>
      <a href="#list" class="block py-2 px-3 rounded-lg hover:bg-indigo-50 hover:text-indigo-600 transition"><i class="fa-solid fa-list-ul mr-1 text-indigo-500"></i> Danh‚ÄØs√°ch</a>
      <a href="#reading" class="block py-2 px-3 rounded-lg hover:bg-indigo-50 hover:text-indigo-600 transition"><i class="fa-solid fa-headphones mr-1 text-indigo-500"></i> ƒêang‚ÄØnghe</a>
      <button id="adminLoginBtn" class="text-pink-600 text-base ml-2 hover:bg-pink-50 p-2 rounded-full transition" title="Qu·∫£n tr·ªã"><i class="fa-solid fa-gear"></i></button>
    </div>
  </div>
</nav>
<script>document.getElementById('menuBtn').addEventListener('click',()=>document.getElementById('navLinks').classList.toggle('hidden'));</script>

<section id="home" class="pt-28 pb-8 text-center text-white px-4 relative overflow-hidden min-h-[50vh]">
  <div class="absolute top-20 left-10 w-32 h-32 bg-purple-600 rounded-full mix-blend-screen filter blur-3xl opacity-20 pointer-events-none"></div>
  <div class="absolute top-20 right-10 w-32 h-32 bg-blue-600 rounded-full mix-blend-screen filter blur-3xl opacity-20 pointer-events-none"></div>
  
  <h2 class="text-3xl md:text-5xl font-extrabold mb-8 drop-shadow-md tracking-wide" data-aos="fade-down">‚ú® Top Truy·ªán Hot ‚ú®</h2>
  <div id="loadingTop" class="loader"></div>
  <div id="topStories" class="flex flex-wrap justify-center gap-6 perspective-1000"></div>
</section>
  
<section id="suggest" class="w-[95%] max-w-3xl mx-auto mt-0 p-6 sm:p-8 glass" data-aos="fade-up" data-aos-duration="800">
  <h2 class="text-2xl sm:text-3xl font-bold text-center mb-6 text-gray-800">
    <i class="fa-solid fa-paper-plane text-indigo-500 floating-deco inline-block"></i> G·ª≠i ƒê·ªÅ Xu·∫•t
  </h2>
  <form id="formSuggest" class="grid gap-5">
    <div class="grid sm:grid-cols-2 gap-5">
      <div class="group relative">
        <i class="fa-solid fa-book absolute left-4 top-3.5 text-gray-400 z-10"></i>
        <input id="title" class="w-full p-3 pl-10 rounded-xl bg-white/80 border border-gray-200 focus:bg-white focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100 outline-none transition shadow-sm" placeholder="T√™n truy·ªán..." required>
      </div>

      <div class="group relative">
        <i class="fa-solid fa-link absolute left-4 top-3.5 text-gray-400 z-10"></i>
        <input 
          id="linkStory" 
          type="url" 
          pattern="https?://.+" 
          required
          class="peer w-full p-3 pl-10 rounded-xl bg-white/80 border border-gray-200 focus:bg-white focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100 outline-none transition shadow-sm
                 invalid:border-red-400 invalid:text-red-600 focus:invalid:border-red-500 placeholder-shown:border-gray-200 placeholder-shown:text-gray-900" 
          placeholder="https://truyen...">
        
        <div class="hidden peer-invalid:flex peer-placeholder-shown:hidden items-center mt-2 text-xs text-red-600 bg-red-50 p-2 rounded border border-red-100">
          <i class="fa-solid fa-circle-exclamation mr-1"></i>
          <span>Link ph·∫£i b·∫Øt ƒë·∫ßu b·∫±ng <b>http://</b> ho·∫∑c <b>https://</b></span>
        </div>
      </div>
    </div>
    
    <div class="flex flex-wrap items-center gap-4 bg-white/60 p-3 rounded-xl border border-white/50 shadow-sm">
      <span class="font-bold text-gray-700 text-sm">Phi√™n b·∫£n:</span>
      <label class="cursor-pointer flex items-center gap-2 px-3 py-1 rounded-full hover:bg-blue-50 transition border border-transparent hover:border-blue-100"><input type="radio" name="version" value="Edit" class="accent-indigo-600 w-4 h-4" required> <span class="text-blue-700 font-semibold text-sm">Edit</span></label>
      <label class="cursor-pointer flex items-center gap-2 px-3 py-1 rounded-full hover:bg-orange-50 transition border border-transparent hover:border-orange-100"><input type="radio" name="version" value="Convert" class="accent-pink-600 w-4 h-4"> <span class="text-orange-700 font-semibold text-sm">Convert</span></label>
    </div>
    
    <textarea id="note" class="w-full p-3 rounded-xl bg-white/80 border border-gray-200 focus:bg-white focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100 outline-none transition shadow-sm" rows="3" placeholder="Review ng·∫Øn / Note cho admin..."></textarea>
    
    <button class="py-3 btn-gradient text-base font-bold uppercase tracking-wider"><i class="fa-solid fa-meteor mr-2"></i> G·ª≠i ngay</button>
  </form>
</section>
  
<section id="list" class="w-[95%] max-w-7xl mx-auto mt-16 p-6 glass" data-aos="fade-up">
  <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
    <h2 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
      <span class="bg-indigo-100 p-2 rounded-lg text-indigo-600 text-lg"><i class="fa-solid fa-layer-group"></i></span>
      Kho T√†ng
    </h2>
    <div class="flex gap-2 w-full md:w-auto">
      <input id="searchInput" class="bg-white/80 border border-white p-2 px-4 rounded-full w-full md:w-60 focus:outline-none focus:ring-2 focus:ring-indigo-200 shadow-sm" placeholder="üîç T√¨m ki·∫øm..." onkeyup="filterStories()">
      <select id="sortSelect" class="bg-white/80 border border-white rounded-full px-4 py-2 text-sm font-semibold text-gray-600 focus:outline-none cursor-pointer shadow-sm" onchange="filterStories()">
        <option value="vote">üî• Hot Vote</option>
        <option value="new">‚è∞ M·ªõi nh·∫•t</option>
      </select>
    </div>
  </div>

  <div id="loadingList" class="loader"></div>
   
  <div class="hidden md:block overflow-hidden rounded-xl shadow-sm border border-gray-100 bg-white/50">
    <table class="w-full text-left border-collapse">
      <thead class="bg-indigo-50 text-indigo-900 h-12 text-sm uppercase">
        <tr><th class="p-3 pl-6">T√™n truy·ªán</th><th>Phi√™n b·∫£n</th><th class="w-1/3">Ghi ch√∫</th><th class="text-center">Vote</th><th class="p-3 text-center">ƒê·ªçc</th></tr>
      </thead>
      <tbody id="storyList" class="divide-y divide-gray-100 text-sm"></tbody>
    </table>
  </div>

  <div id="storyListMobile" class="md:hidden space-y-4"></div>
</section>

<section id="reading" class="w-[95%] max-w-5xl mx-auto mt-16 p-6 glass mb-24" data-aos="fade-up">
  <h2 class="text-2xl font-bold text-center mb-6 text-gray-800"><i class="fa-solid fa-podcast text-green-500 mr-2"></i> ƒêang L√™n S√≥ng</h2>
  <div id="readingList" class="grid sm:grid-cols-2 gap-4"></div>
</section>

<section id="admin" class="hidden w-[95%] max-w-7xl mx-auto mt-10 mb-10 p-6 bg-white/95 backdrop-blur-xl rounded-2xl shadow-2xl border border-white/50 relative overflow-hidden">
  <div class="absolute top-0 right-0 w-64 h-64 bg-indigo-100 rounded-full mix-blend-multiply filter blur-3xl opacity-30 pointer-events-none"></div>

  <div class="relative z-10">
    <div class="flex flex-col md:flex-row justify-between items-center mb-8 border-b border-gray-100 pb-4 gap-4">
      <h2 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
        <span class="bg-red-100 text-red-600 p-2 rounded-lg"><i class="fa-solid fa-user-shield"></i></span>
        Trung T√¢m ƒêi·ªÅu H√†nh
      </h2>
      <button class="px-5 py-2 bg-gray-800 text-white rounded-xl hover:bg-gray-900 transition shadow-lg flex items-center gap-2" id="logoutBtn">
        <i class="fa-solid fa-right-from-bracket"></i> Tho√°t
      </button>
    </div>

    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
      <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
        <p class="text-xs text-blue-500 font-bold uppercase">T·ªïng s·ªë</p>
        <p class="text-2xl font-bold text-gray-800" id="statTotal">0</p>
      </div>
      <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-100">
        <p class="text-xs text-yellow-600 font-bold uppercase">ƒê·ªÅ xu·∫•t m·ªõi</p>
        <p class="text-2xl font-bold text-gray-800" id="statSuggest">0</p>
      </div>
      <div class="bg-green-50 p-4 rounded-xl border border-green-100">
        <p class="text-xs text-green-600 font-bold uppercase">ƒêang ƒë·ªçc</p>
        <p class="text-2xl font-bold text-gray-800" id="statReading">0</p>
      </div>
      <div class="bg-purple-50 p-4 rounded-xl border border-purple-100">
        <p class="text-xs text-purple-600 font-bold uppercase">ƒê√£ ho√†n th√†nh</p>
        <p class="text-2xl font-bold text-gray-800" id="statDone">0</p>
      </div>
    </div>

    <div class="flex flex-col sm:flex-row gap-3 mb-4">
      <div class="relative flex-1">
        <i class="fa-solid fa-magnifying-glass absolute left-3 top-3 text-gray-400"></i>
        <input id="adminSearch" onkeyup="renderAdmin()" class="w-full pl-10 pr-4 py-2.5 rounded-xl bg-gray-50 border border-gray-200 focus:bg-white focus:ring-2 focus:ring-indigo-200 outline-none transition" placeholder="T√¨m t√™n truy·ªán trong kho...">
      </div>
      <select id="adminFilter" onchange="renderAdmin()" class="px-4 py-2.5 rounded-xl bg-gray-50 border border-gray-200 focus:outline-none cursor-pointer font-medium text-gray-600">
        <option value="all">T·∫•t c·∫£ tr·∫°ng th√°i</option>
        <option value="ƒë·ªÅ‚ÄØxu·∫•t">ƒê·ªÅ xu·∫•t</option>
        <option value="ƒëang‚ÄØƒë·ªçc">ƒêang ƒë·ªçc</option>
        <option value="ƒë√£‚ÄØƒë·ªçc">ƒê√£ ƒë·ªçc</option>
      </select>
    </div>

    <div class="hidden md:block overflow-x-auto rounded-xl border border-gray-100 shadow-sm">
      <table class="w-full text-left border-collapse">
        <thead class="bg-gray-50 text-gray-500 text-xs uppercase font-bold tracking-wider">
          <tr>
            <th class="p-4">Truy·ªán / Link G·ªëc</th>
            <th class="p-4">Tr·∫°ng th√°i</th>
            <th class="p-4">Link Youtube</th>
            <th class="p-4 text-center">T√°c v·ª•</th>
          </tr>
        </thead>
        <tbody id="adminTable" class="bg-white divide-y divide-gray-50 text-sm text-gray-700"></tbody>
      </table>
    </div>

    <div id="adminGrid" class="md:hidden grid gap-4"></div>
  </div>
</section>

<footer class="glass mt-10 p-6 text-center border-t border-white/40">
  <p class="text-gray-700 font-semibold text-sm">¬© 2025 H·ªìi √Çm ƒêam M·ªπ <br> <span class="text-xs text-gray-500 font-normal">Made with <i class="fa-solid fa-heart text-red-500"></i> in the Galaxy</span></p>
</footer>

<script>
AOS.init({ once: true, offset: 50, duration: 600, easing: 'ease-out-cubic' });

// Supabase Config
const SUPABASE_URL='https://xklmcebwxkqbotqexprn.supabase.co';
const SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhrbG1jZWJ3eGtxYm90cWV4cHJuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2MzM1NDEsImV4cCI6MjA3OTIwOTU0MX0.vZj-5C_HhVgemG0LOTH3axf4P0bxXngzeQ3PSo93-m4';
const TABLE='stories';
let stories=[];

// --- DATA FETCHING ---
async function fetchStories(){
  document.getElementById('loadingTop').style.display='block';
  document.getElementById('loadingList').style.display='block';
  try {
    const res=await fetch(`${SUPABASE_URL}/rest/v1/${TABLE}?select=*`,{headers:{apikey:SUPABASE_KEY,Authorization:`Bearer ${SUPABASE_KEY}`}});
    if(!res.ok) throw new Error('Err');
    stories=await res.json();
    refresh();
  } catch(e) { Swal.fire('L·ªói k·∫øt n·ªëi', 'Vui l√≤ng t·∫£i l·∫°i trang', 'error'); }
  finally {
    document.getElementById('loadingTop').style.display='none';
    document.getElementById('loadingList').style.display='none';
  }
}

async function addStory(s){
  Swal.fire({title:'ƒêang g·ª≠i...',allowOutsideClick: false, didOpen:()=>{Swal.showLoading()}});
  const res=await fetch(`${SUPABASE_URL}/rest/v1/${TABLE}`,{method:'POST',headers:{'Content-Type':'application/json',apikey:SUPABASE_KEY,Authorization:`Bearer ${SUPABASE_KEY}`,Prefer:'return=representation'},body:JSON.stringify(s)});
  if(res.ok){
    const data=await res.json();stories.push(data[0]);refresh();
    Swal.fire({icon:'success',title:'ƒê√£ g·ª≠i!',text:'C·∫£m ∆°n b·∫°n ƒë√£ ƒë√≥ng g√≥p.',confirmButtonColor:'#764ba2'});
  } else Swal.fire('L·ªói','Kh√¥ng g·ª≠i ƒë∆∞·ª£c','error');
}

async function updateStory(id,d){
  await fetch(`${SUPABASE_URL}/rest/v1/${TABLE}?id=eq.${id}`,{method:'PATCH',headers:{'Content-Type':'application/json',apikey:SUPABASE_KEY,Authorization:`Bearer ${SUPABASE_KEY}`},body:JSON.stringify(d)});
  const index = stories.findIndex(s => s.id === id);
  if (index !== -1) stories[index] = { ...stories[index], ...d };
  refresh();
}

async function deleteStory(id){
  const cf=await Swal.fire({title:'X√≥a?',text:'H√†nh ƒë·ªông kh√¥ng th·ªÉ ho√†n t√°c!',icon:'warning',showCancelButton:true,confirmButtonColor:'#d33',confirmButtonText:'X√≥a lu√¥n'});
  if(cf.isConfirmed){
    await fetch(`${SUPABASE_URL}/rest/v1/${TABLE}?id=eq.${id}`,{method:'DELETE',headers:{apikey:SUPABASE_KEY,Authorization:`Bearer ${SUPABASE_KEY}`}});
    stories=stories.filter(s=>s.id!==id);refresh();Swal.fire('ƒê√£ x√≥a!','','success');
  }
}

// --- USER ACTIONS ---
async function toggleVote(id){
  const key=`vote_${id}`,st=stories.find(s=>s.id===id);if(!st)return;
  let v=st.votes||0;
  const btn = document.querySelector(`.vote-btn-${id}`);
  
  if(localStorage.getItem(key)){
    localStorage.removeItem(key);v=Math.max(0,v-1);
    if(btn) btn.classList.remove('text-red-500');
  } else {
    localStorage.setItem(key,'true');v++;
    if(btn) btn.classList.add('text-red-500');
  }
  st.votes=v; 
  // Update UI immediately
  const countEl = document.getElementById(`vote-count-${id}`);
  if(countEl) countEl.innerText = v;
  await updateStory(id,{votes:v});
}
function userVoted(id){return localStorage.getItem(`vote_${id}`);}

document.getElementById('formSuggest').addEventListener("submit",e=>{
  e.preventDefault();
  const s={
    title:document.getElementById('title').value.trim(),
    linkstory:document.getElementById('linkStory').value.trim(),
    version:document.querySelector('input[name="version"]:checked')?.value||'',
    note:document.getElementById('note').value.trim(),
    votes:0,status:'ƒë·ªÅ‚ÄØxu·∫•t',youtubelink:'',createdat:new Date().toISOString()
  };
  addStory(s);e.target.reset();
});

// --- RENDER LOGIC ---
function refresh(){
  filterStories(); 
  renderReading(); 
  if(!document.getElementById('admin').classList.contains('hidden')) renderAdmin();
}

function filterStories(){
  const keyword = document.getElementById('searchInput').value.toLowerCase();
  const sortMode = document.getElementById('sortSelect').value;
  let list = stories.filter(s => s.status === 'ƒë·ªÅ‚ÄØxu·∫•t' && s.title.toLowerCase().includes(keyword));
  if(sortMode === 'vote') list.sort((a,b) => b.votes - a.votes);
  else if(sortMode === 'new') list.sort((a,b) => new Date(b.createdat) - new Date(a.createdat));

  renderTop(list);
  renderListPC(list);
  renderListMobile(list);
}

function renderTop(list){
  const c=document.getElementById('topStories');c.innerHTML='';
  const top = [...list].sort((a,b)=>b.votes-a.votes).slice(0,3);
  if(top.length===0) c.innerHTML='<p class="text-gray-300 italic text-sm">V≈© tr·ª• ƒëang im l·∫∑ng...</p>';
   
  top.forEach((s,i)=>{
    let medal = i===0 ? 'ü•á' : (i===1 ? 'ü•à' : 'ü•â');
    let colorClass = i===0 ? 'border-yellow-400/50 shadow-yellow-200/50' : (i===1 ? 'border-gray-300/50 shadow-gray-200/50' : 'border-orange-300/50 shadow-orange-200/50');
    c.innerHTML+=`
    <div class="relative w-64 p-4 bg-white/90 backdrop-blur-sm rounded-2xl shadow-lg border ${colorClass} transform hover:-translate-y-1 transition duration-300 group">
      <div class="absolute -top-4 left-1/2 transform -translate-x-1/2 text-3xl drop-shadow-sm z-10">${medal}</div>
      <div class="mt-4 text-center">
        <h5 class="font-bold text-gray-800 mb-1 line-clamp-2 text-base leading-tight group-hover:text-indigo-600 transition">${s.title}</h5>
        <div class="w-8 h-1 bg-gray-200 mx-auto rounded mb-2"></div>
        <p class="text-xs text-gray-500 mb-3 bg-gray-50 p-2 rounded border border-gray-100 min-h-[36px] line-clamp-2">"${s.note||'...'}"</p>
        <div class="flex justify-between items-center bg-white p-1.5 rounded-full shadow-inner border border-gray-100">
          <span class="text-pink-600 font-bold text-xs px-2 flex items-center gap-1"><i class="fa-solid fa-heart"></i> ${s.votes}</span>
          ${s.linkstory ? `<a href="${s.linkstory}" target="_blank" class="bg-indigo-500 text-white w-7 h-7 rounded-full flex items-center justify-center hover:bg-indigo-700 transition"><i class="fa-solid fa-arrow-right text-xs"></i></a>` : ''}
        </div>
      </div>
    </div>`;
  });
}

function renderListPC(list){
  const tb=document.getElementById('storyList');tb.innerHTML='';
  list.forEach((s)=>{
    tb.innerHTML+=`
    <tr class="hover:bg-gray-50 border-b border-gray-50 transition">
      <td class="p-3 pl-6 font-semibold text-gray-800">
        <div class="flex flex-col">
          <a href="${s.linkstory||'#'}" target="_blank" class="hover:text-indigo-600 transition">${s.title}</a>
          ${s.createdat && ((new Date()-new Date(s.createdat))/(1000*3600*24)<3) ? '<span class="text-[9px] font-bold text-green-600 uppercase tracking-wider flex items-center gap-1 mt-1"><span class="w-1 h-1 bg-green-500 rounded-full"></span> New</span>':''}
        </div>
      </td>
      <td class="p-3"><span class="px-2 py-0.5 rounded text-[11px] font-bold border ${s.version==='Edit'?'bg-blue-50 text-blue-600 border-blue-100':'bg-orange-50 text-orange-600 border-orange-100'}">${s.version}</span></td>
      <td class="p-3 text-xs text-gray-500 italic whitespace-normal break-words align-top leading-relaxed max-w-xs">${s.note||'-'}</td>
      <td class="p-3 text-center">
        <button onclick="toggleVote(${s.id})" class="vote-btn-${s.id} transition active:scale-90 ${userVoted(s.id)?'text-red-500':'text-gray-300 hover:text-red-300'}">
          <i class="fa-solid fa-heart text-lg"></i>
        </button>
        <div id="vote-count-${s.id}" class="text-[10px] font-bold mt-0.5 text-gray-500">${s.votes}</div>
      </td>
      <td class="p-3 text-center">
        ${s.linkstory ? `<a href="${s.linkstory}" target="_blank" class="text-indigo-400 hover:text-indigo-600 text-lg transition"><i class="fa-solid fa-book-open"></i></a>` : '<span class="text-gray-200"><i class="fa-solid fa-ban"></i></span>'}
      </td>
    </tr>`;
  });
}

function renderListMobile(list){
  const mb=document.getElementById('storyListMobile');mb.innerHTML='';
  list.forEach((s)=>{
    mb.innerHTML+=`
    <div class="bg-white/90 backdrop-blur-sm p-4 rounded-xl shadow-sm border border-gray-100 flex justify-between items-start">
      <div class="flex-1 pr-3">
        <h4 class="font-bold text-gray-800 text-base mb-1 leading-tight">${s.title}</h4>
        <div class="flex items-center gap-2 mb-2">
          <span class="text-[10px] px-1.5 py-0.5 rounded border ${s.version==='Edit'?'bg-blue-50 text-blue-600 border-blue-100':'bg-orange-50 text-orange-600 border-orange-100'} font-bold">${s.version}</span>
          ${s.createdat && ((new Date()-new Date(s.createdat))/(1000*3600*24)<3) ? '<span class="text-[9px] text-green-600 font-bold border border-green-200 px-1 rounded bg-green-50">NEW</span>':''}
        </div>
        <p class="text-xs text-gray-500 mb-2 italic text-justify line-clamp-3">"${s.note||'...'}"</p>
        ${s.linkstory ? `<a href="${s.linkstory}" target="_blank" class="text-indigo-600 text-xs font-bold hover:underline flex items-center gap-1"><i class="fa-solid fa-book-reader"></i> ƒê·ªçc ngay</a>` : ''}
      </div>
      <div class="flex flex-col items-center justify-center pl-3 border-l border-dashed border-gray-200">
        <button onclick="toggleVote(${s.id})" class="vote-btn-${s.id} ${userVoted(s.id)?'text-red-500':'text-gray-300'} text-xl mb-1 transition active:scale-90"><i class="fa-solid fa-heart"></i></button>
        <span id="vote-count-${s.id}" class="font-bold text-gray-500 text-xs">${s.votes}</span>
      </div>
    </div>`;
  });
}

function renderReading(){
  const list=stories.filter(s=>s.status==='ƒëang‚ÄØƒë·ªçc');
  const c = document.getElementById('readingList');
  if(list.length === 0) {
    c.innerHTML = '<div class="col-span-2 text-center text-gray-400 italic text-sm">Hi·ªán ch∆∞a c√≥ radio n√†o...</div>';
    return;
  }
  c.innerHTML=list.map((s)=>`
    <a href="${s.youtubelink}" target="_blank" class="flex items-center p-3 bg-white/90 rounded-xl shadow-sm hover:shadow-md transition border border-gray-100 group">
      <div class="relative w-10 h-10 mr-3">
          <div class="relative bg-gradient-to-br from-green-400 to-teal-500 text-white w-10 h-10 rounded-full flex items-center justify-center shadow group-hover:scale-110 transition"><i class="fa-solid fa-play ml-0.5 text-xs"></i></div>
      </div>
      <div class="flex-1 overflow-hidden">
        <h4 class="font-bold text-gray-800 text-sm truncate group-hover:text-green-600 transition">${s.title}</h4>
        <div class="flex items-center gap-2 mt-0.5">
           <span class="w-8 h-0.5 bg-gray-200 overflow-hidden"><div class="h-full bg-green-500 animate-[loading_2s_ease-in-out_infinite] w-1/2"></div></span>
           <p class="text-[10px] text-gray-500">ƒêang ph√°t</p>
        </div>
      </div>
    </a>`).join('');
}

// --- ADMIN CONTROL ---
document.getElementById('adminLoginBtn').addEventListener('click', async () => {
  const { value: p } = await Swal.fire({
    title: 'V√πng Qu·∫£n Tr·ªã',
    input: 'password',
    inputPlaceholder: 'Nh·∫≠p m·∫≠t kh·∫©u...',
    inputAttributes: { autocapitalize: 'off', autocorrect: 'off' },
    confirmButtonText: 'M·ªü kh√≥a',
    confirmButtonColor: '#4f46e5'
  });

  if (p === 'hoiam20102003') {
    document.getElementById('admin').classList.remove('hidden');
    document.getElementById('admin').scrollIntoView({ behavior: 'smooth' });
    renderAdmin();
    Swal.fire({ icon: 'success', title: 'Xin ch√†o Admin', toast: true, position: 'top-end', showConfirmButton: false, timer: 2000 });
  } else if (p) {
    Swal.fire('Sai m·∫≠t kh·∫©u!', 'Vui l√≤ng th·ª≠ l·∫°i', 'error');
  }
});

document.getElementById('logoutBtn').addEventListener('click', () => {
  document.getElementById('admin').classList.add('hidden');
  window.scrollTo({ top: 0, behavior: 'smooth' });
});

function renderAdmin() {
  const keyword = document.getElementById('adminSearch').value.toLowerCase();
  const filter = document.getElementById('adminFilter').value;

  let list = stories.filter(s => s.title.toLowerCase().includes(keyword));
  if (filter !== 'all') list = list.filter(s => s.status === filter);

  // Update Stats
  document.getElementById('statTotal').innerText = stories.length;
  document.getElementById('statSuggest').innerText = stories.filter(s => s.status === 'ƒë·ªÅ‚ÄØxu·∫•t').length;
  document.getElementById('statReading').innerText = stories.filter(s => s.status === 'ƒëang‚ÄØƒë·ªçc').length;
  document.getElementById('statDone').innerText = stories.filter(s => s.status === 'ƒë√£‚ÄØƒë·ªçc').length;

  const tableBody = document.getElementById('adminTable');
  const gridBody = document.getElementById('adminGrid');
  
  tableBody.innerHTML = '';
  gridBody.innerHTML = '';

  if (list.length === 0) {
    tableBody.innerHTML = '<tr><td colspan="4" class="p-8 text-center text-gray-400">Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu</td></tr>';
    gridBody.innerHTML = '<div class="p-8 text-center text-gray-400">Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu</div>';
    return;
  }

  list.forEach(s => {
    let statusClass = s.status === 'ƒë·ªÅ‚ÄØxu·∫•t' ? 'bg-yellow-100 text-yellow-700 border-yellow-200' 
                    : (s.status === 'ƒëang‚ÄØƒë·ªçc' ? 'bg-green-100 text-green-700 border-green-200' : 'bg-gray-100 text-gray-600 border-gray-200');

    // PC Table
    tableBody.innerHTML += `
      <tr class="hover:bg-indigo-50/30 transition group">
        <td class="p-4">
          <div class="font-bold text-gray-800 text-base mb-1">${s.title}</div>
          <div class="flex items-center gap-2">
             <span class="text-[10px] px-1.5 py-0.5 rounded border bg-white text-gray-500 font-mono">${s.version}</span>
             ${s.linkstory ? `<a href="${s.linkstory}" target="_blank" class="text-indigo-500 hover:underline text-xs truncate max-w-[200px] block"><i class="fa-solid fa-link mr-1"></i>Link g·ªëc</a>` : '<span class="text-xs text-gray-400">No link</span>'}
          </div>
        </td>
        <td class="p-4"><span class="px-3 py-1 text-xs rounded-full font-bold border ${statusClass}">${s.status}</span></td>
        <td class="p-4">${s.youtubelink ? `<a href="${s.youtubelink}" target="_blank" class="text-red-600 hover:text-red-800 text-xs font-medium truncate max-w-[150px] block"><i class="fa-brands fa-youtube mr-1"></i> Youtube Link</a>` : '<span class="text-gray-400 text-xs italic">Ch∆∞a c√≥ link</span>'}</td>
        <td class="p-4 text-center">
          <div class="flex justify-center gap-2 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition">
            <button class="w-8 h-8 rounded-full bg-blue-50 text-blue-600 hover:bg-blue-600 hover:text-white transition shadow-sm" onclick="editStoryPopup(${s.id})" title="S·ª≠a"><i class="fa-solid fa-pen"></i></button>
            <button class="w-8 h-8 rounded-full bg-red-50 text-red-600 hover:bg-red-600 hover:text-white transition shadow-sm" onclick="deleteStory(${s.id})" title="X√≥a"><i class="fa-solid fa-trash"></i></button>
          </div>
        </td>
      </tr>`;

    // Mobile Grid
    gridBody.innerHTML += `
      <div class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm flex flex-col gap-3">
        <div class="flex justify-between items-start">
           <div>
              <h4 class="font-bold text-gray-800 text-lg leading-tight">${s.title}</h4>
              <a href="${s.linkstory||'#'}" target="_blank" class="text-indigo-500 text-xs mt-1 block truncate max-w-[200px]"><i class="fa-solid fa-link"></i> Link g·ªëc</a>
           </div>
           <span class="px-2 py-1 text-[10px] rounded font-bold border ${statusClass} whitespace-nowrap">${s.status}</span>
        </div>
        <div class="bg-gray-50 p-2 rounded-lg text-xs text-gray-600 break-words"><i class="fa-solid fa-note-sticky text-gray-400 mr-1"></i> ${s.note || 'Kh√¥ng c√≥ ghi ch√∫'}</div>
        ${s.youtubelink ? `<a href="${s.youtubelink}" class="text-red-600 text-xs font-bold"><i class="fa-brands fa-youtube"></i> Xem tr√™n Youtube</a>` : ''}
        <div class="flex gap-2 mt-2 pt-3 border-t border-gray-100">
          <button onclick="editStoryPopup(${s.id})" class="flex-1 py-2 bg-blue-50 text-blue-700 rounded-lg font-bold text-sm hover:bg-blue-100 transition">S·ª≠a</button>
          <button onclick="deleteStory(${s.id})" class="flex-1 py-2 bg-red-50 text-red-700 rounded-lg font-bold text-sm hover:bg-red-100 transition">X√≥a</button>
        </div>
      </div>`;
  });
}

function editStoryPopup(id) {
  const s = stories.find(x => x.id === id);
  if (!s) return;

  Swal.fire({
    title: 'üìù C·∫≠p nh·∫≠t truy·ªán',
    html: `
      <div class="text-left space-y-3">
        <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">T√™n truy·ªán</label><input id="edit-title" class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-indigo-200 outline-none" value="${s.title}"></div>
        <div class="grid grid-cols-2 gap-3">
           <div>
              <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Tr·∫°ng th√°i</label>
              <select id="edit-status" class="w-full p-2 border rounded-lg bg-white">
                <option value="ƒë·ªÅ‚ÄØxu·∫•t" ${s.status === 'ƒë·ªÅ‚ÄØxu·∫•t' ? 'selected' : ''}>ƒê·ªÅ xu·∫•t</option>
                <option value="ƒëang‚ÄØƒë·ªçc" ${s.status === 'ƒëang‚ÄØƒë·ªçc' ? 'selected' : ''}>ƒêang ƒë·ªçc</option>
                <option value="ƒë√£‚ÄØƒë·ªçc" ${s.status === 'ƒë√£‚ÄØƒë·ªçc' ? 'selected' : ''}>ƒê√£ ƒë·ªçc</option>
              </select>
           </div>
           <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">Votes</label><input type="number" id="edit-votes" class="w-full p-2 border rounded-lg" value="${s.votes}"></div>
        </div>
        <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">Link Youtube (Radio)</label><input id="edit-youtube" class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-red-200 outline-none" placeholder="https://youtube..." value="${s.youtubelink || ''}"></div>
         <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">Link Truy·ªán G·ªëc</label><input id="edit-link" class="w-full p-2 border rounded-lg text-sm text-gray-600" value="${s.linkstory || ''}"></div>
      </div>
    `,
    showCancelButton: true,
    confirmButtonText: 'L∆∞u',
    confirmButtonColor: '#4f46e5',
    preConfirm: () => {
      return {
        title: document.getElementById('edit-title').value.trim(),
        status: document.getElementById('edit-status').value,
        votes: parseInt(document.getElementById('edit-votes').value) || 0,
        youtubelink: document.getElementById('edit-youtube').value.trim(),
        linkstory: document.getElementById('edit-link').value.trim()
      }
    }
  }).then(async (result) => {
    if (result.isConfirmed) {
      await updateStory(id, result.value);
      Swal.fire('ƒê√£ l∆∞u!', '', 'success');
    }
  });
}

window.onload=fetchStories;
</script>
</body>
</html>
