<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>H·ªìi‚ÄØ√Çm‚ÄØƒêam‚ÄØM·ªπ‚ÄØ‚Äì‚ÄØGalaxy‚ÄØEdition</title>
<link rel="icon" type="image/x-icon" href="favicon.ico">

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap');
  body{font-family:'Quicksand',sans-serif;color:#222;overflow-x:hidden;margin:0; background-color: #000;}

  /* --- M·ªöI: CONTAINER CHO N·ªÄN 3D --- */
  #bg-3d {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: -10; /* ƒê·∫∑t ph√≠a sau n·ªôi dung */
    pointer-events: none; /* Kh√¥ng ch·∫∑n chu·ªôt click v√†o n·ªôi dung */
  }

  /* --- HI·ªÜU ·ª®NG K√çNH (ƒêi·ªÅu ch·ªânh l·∫°i m·ªôt ch√∫t cho h·ª£p n·ªÅn t·ªëi) --- */
  .glass {
    background: rgba(255, 255, 255, 0.1); /* Gi·∫£m ƒë·ªô ƒë·ª•c ƒë·ªÉ nh√¨n xuy√™n n·ªÅn */
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 24px;
    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3); /* B√≥ng t·ªëi h∆°n */
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    color: #fff; /* Ch·ªØ m√†u tr·∫Øng */
  }
  .glass:hover {
    transform: translateY(-5px) scale(1.005);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
    background: rgba(255, 255, 255, 0.15);
  }
  /* ƒêi·ªÅu ch·ªânh m√†u ch·ªØ trong c√°c th·∫ª glass */
  .glass h2, .glass span, .glass label { color: #fff !important; }
  .glass input, .glass textarea, .glass select {
      background-color: rgba(255,255,255,0.2) !important;
      color: #fff !important;
      border-color: rgba(255,255,255,0.3) !important;
  }
  .glass input::placeholder, .glass textarea::placeholder { color: rgba(255,255,255,0.6); }
  .glass .text-gray-500, .glass .text-gray-600, .glass .text-gray-700, .glass .text-gray-800 { color: #e5e7eb !important; } /* Chuy·ªÉn x√°m th√†nh tr·∫Øng m·ªù */


  /* --- ANIMATION --- */
  @keyframes float {
    0% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
    100% { transform: translateY(0px); }
  }
  .floating-element { animation: float 6s ease-in-out infinite; }
  .floating-delayed { animation: float 7s ease-in-out infinite 1s; }

  .text-shimmer {
    background: linear-gradient(to right, #667eea 0%, #764ba2 40%, #ff7eb3 50%, #764ba2 60%, #667eea 100%);
    background-size: 200% auto;
    color: #fff;
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: shine 3s linear infinite;
    font-weight: 800;
  }
  @keyframes shine { to { background-position: 200% center; } }

  .btn-gradient {
    background-size: 200% auto;
    background-image: linear-gradient(to right, #667eea 0%, #764ba2 51%, #667eea 100%);
    color: #fff; border: none; border-radius: 30px;
    transition: 0.5s;
    box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
  }
  .btn-gradient:hover { background-position: right center; color: #fff; text-decoration: none; box-shadow: 0 10px 30px rgba(118, 75, 162, 0.7); }

  .table-row-anim { transition: transform 0.2s, background-color 0.2s; }
  .table-row-anim:hover { transform: scale(1.01); background-color: rgba(255,255,255,0.1) !important; z-index: 10; position: relative; }

  .vinyl-record {
    width: 40px; height: 40px; border-radius: 50%;
    background: repeating-radial-gradient(#111 0, #111 2px, #333 3px, #333 4px);
    position: relative; border: 2px solid #fff; box-shadow: 0 0 10px rgba(255,255,255,0.5);
    animation: vinyl-spin 5s linear infinite;
  }
  .vinyl-record::after {content:'';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:12px;height:12px;background:radial-gradient(circle, #ff5f6d, #ffc371);border-radius:50%;}
  @keyframes vinyl-spin {from{transform:rotate(0deg);}to{transform:rotate(360deg);}}

  .loader {width: 48px;height: 48px;border: 5px solid #FFF;border-bottom-color: #764ba2;border-radius: 50%;display: inline-block;box-sizing: border-box;animation: rotation 1s linear infinite; margin: 20px auto;}
  @keyframes rotation {0% {transform: rotate(0deg);}100% {transform: rotate(360deg);}}

  /* Nav links color on dark background */
  #navLinks a { color: #fff; }
  #navLinks a:hover { color: #a78bfa; /* Indigo-400 */ }
  #menuBtn { color: #fff; }
</style>
</head>

<body>

<div id="bg-3d"></div>

<script>
  // 1. Setup Scence, Camera, Renderer
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
  const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setPixelRatio(window.devicePixelRatio);
  document.getElementById('bg-3d').appendChild(renderer.domElement);

  // 2. T·∫°o nh√≥m ch·ª©a Tr√°i ƒê·∫•t v√† M√¢y
  const earthGroup = new THREE.Group();
  earthGroup.rotation.z = -23.4 * Math.PI / 180; // Nghi√™ng tr·ª•c Tr√°i ƒê·∫•t
  scene.add(earthGroup);

  const textureLoader = new THREE.TextureLoader();

  // 3. T·∫°o Tr√°i ƒê·∫•t (Earth Sphere)
  // S·ª≠ d·ª•ng texture ch·∫•t l∆∞·ª£ng cao t·ª´ c√°c ngu·ªìn public
  const earthGeometry = new THREE.SphereGeometry(1.5, 64, 64);
  const earthMaterial = new THREE.MeshPhongMaterial({
    map: textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/earth_atmos_2048.jpg'),
    bumpMap: textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/earth_normal_2048.jpg'),
    bumpScale: 0.05,
    specularMap: textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/earth_specular_2048.jpg'),
    specular: new THREE.Color('grey'),
    shininess: 10 
  });
  const earthMesh = new THREE.Mesh(earthGeometry, earthMaterial);
  earthGroup.add(earthMesh);

  // 4. T·∫°o l·ªõp M√¢y (Cloud Layer) - L·ªõn h∆°n Tr√°i ƒê·∫•t m·ªôt ch√∫t
  const cloudGeometry = new THREE.SphereGeometry(1.53, 64, 64);
  const cloudMaterial = new THREE.MeshPhongMaterial({
    map: textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/earth_clouds_1024.png'),
    transparent: true,
    opacity: 0.4,
    blending: THREE.AdditiveBlending
  });
  const cloudMesh = new THREE.Mesh(cloudGeometry, cloudMaterial);
  earthGroup.add(cloudMesh);

  // 5. T·∫°o N·ªÅn Ng√¢n H√† (Galaxy Background) - M·ªôt h√¨nh c·∫ßu kh·ªïng l·ªì bao quanh
  const starGeometry = new THREE.SphereGeometry(80, 64, 64);
  const starMaterial = new THREE.MeshBasicMaterial({
    map: textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/starfield.png'), // Ho·∫∑c texture galaxy m√†u s·∫Øc h∆°n n·∫øu mu·ªën
    side: THREE.BackSide // Render m·∫∑t trong c·ªßa h√¨nh c·∫ßu
  });
  const starMesh = new THREE.Mesh(starGeometry, starMaterial);
  scene.add(starMesh);

  // 6. √Ånh s√°ng
  const ambientLight = new THREE.AmbientLight(0x404040, 0.5); // √Ånh s√°ng m√¥i tr∆∞·ªùng y·∫øu
  scene.add(ambientLight);

  // √Ånh s√°ng m·∫∑t tr·ªùi (Directional Light) chi·∫øu t·ª´ m·ªôt ph√≠a
  const sunLight = new THREE.DirectionalLight(0xffffff, 1.5);
  sunLight.position.set(-5, 3, 5);
  scene.add(sunLight);

  // ƒê·∫∑t v·ªã tr√≠ camera
  camera.position.z = 4;

  // 7. Animation Loop (V√≤ng l·∫∑p chuy·ªÉn ƒë·ªông)
  function animate3D() {
    requestAnimationFrame(animate3D);

    // Xoay Tr√°i ƒê·∫•t
    earthMesh.rotation.y += 0.0015;
    // Xoay l·ªõp m√¢y nhanh h∆°n m·ªôt ch√∫t ƒë·ªÉ t·∫°o hi·ªáu ·ª©ng ƒë·ªông
    cloudMesh.rotation.y += 0.002;
    cloudMesh.rotation.x += 0.0005;

    // Xoay n·ªÅn ng√¢n h√† th·∫≠t ch·∫≠m
    starMesh.rotation.y -= 0.0002;

    renderer.render(scene, camera);
  }
  animate3D();

  // X·ª≠ l√Ω khi thay ƒë·ªïi k√≠ch th∆∞·ªõc m√†n h√¨nh
  window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
</script>


<nav class="fixed w-full backdrop-blur-md bg-black/30 shadow-lg z-50 transition-all duration-300 border-b border-white/10">
  <div class="max-w-7xl mx-auto flex items-center justify-between p-3">
    <a href="#home" class="text-2xl font-bold flex items-center gap-3 group">
      <div class="vinyl-record group-hover:scale-110 transition duration-500"></div> 
      <span class="text-shimmer text-xl sm:text-2xl">H·ªìi‚ÄØ√Çm‚ÄØƒêam‚ÄØM·ªπ</span>
    </a>
    <button id="menuBtn" class="sm:hidden text-2xl focus:outline-none transform active:scale-90"><i class="fa-solid fa-bars"></i></button>
    <div id="navLinks" class="hidden sm:flex flex-col sm:flex-row sm:items-center sm:space-x-6 absolute sm:static w-full sm:w-auto bg-black/80 sm:bg-transparent left-0 top-16 sm:top-auto shadow-xl sm:shadow-none font-bold p-4 sm:p-0 rounded-b-2xl sm:rounded-none">
      <a href="#suggest" class="block py-2 px-4 rounded-full hover:bg-white/10 transition duration-300"><i class="fa-solid fa-pen-nib mr-1 text-indigo-400"></i> ƒê·ªÅ‚ÄØxu·∫•t</a>
      <a href="#list" class="block py-2 px-4 rounded-full hover:bg-white/10 transition duration-300"><i class="fa-solid fa-list-ul mr-1 text-indigo-400"></i> Danh‚ÄØs√°ch</a>
      <a href="#reading" class="block py-2 px-4 rounded-full hover:bg-white/10 transition duration-300"><i class="fa-solid fa-headphones mr-1 text-indigo-400"></i> ƒêang‚ÄØnghe</a>
      <button id="adminLoginBtn" class="text-pink-500 text-lg hover:rotate-180 transition duration-700 ml-2" title="Qu·∫£n tr·ªã"><i class="fa-solid fa-gear"></i></button>
    </div>
  </div>
</nav>
<script>document.getElementById('menuBtn').addEventListener('click',()=>document.getElementById('navLinks').classList.toggle('hidden'));</script>

<section id="home" class="pt-36 pb-10 text-center text-white px-4 relative overflow-hidden" style="min-height: 80vh; display: flex; flex-direction: column; justify-content: flex-start;">
  <h2 class="text-4xl md:text-6xl font-extrabold mb-6 drop-shadow-[0_5px_5px_rgba(0,0,0,0.8)] tracking-wide text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400" data-aos="zoom-in">‚ú® V≈© Tr·ª• ƒêam M·ªπ ‚ú®</h2>
  <p class="text-lg text-gray-300 mb-10" data-aos="fade-up" data-aos-delay="200">Kh√°m ph√° nh·ªØng c√¢u chuy·ªán gi·ªØa ng√¢n h√† bao la</p>
  <div id="loadingTop" class="loader"></div>
  <div id="topStories" class="flex flex-wrap justify-center gap-8 perspective-1000"></div>
</section>

<section id="suggest" class="w-[95%] max-w-4xl mx-auto mt-6 p-8 glass floating-element" data-aos="fade-up" data-aos-duration="1000">
  <h2 class="text-3xl font-bold text-center mb-6"><i class="fa-solid fa-paper-plane text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-400"></i> G·ª≠i ƒê·ªÅ Xu·∫•t</h2>
  <form id="formSuggest" class="grid gap-6">
    <div class="grid sm:grid-cols-2 gap-6">
      <div class="group relative">
        <i class="fa-solid fa-book absolute left-4 top-4 text-gray-400 group-focus-within:text-indigo-400 transition"></i>
        <input id="title" class="w-full p-3 pl-10 rounded-xl outline-none transition duration-300" placeholder="T√™n truy·ªán..." required>
      </div>

      <div class="group relative">
        <i class="fa-solid fa-link absolute left-4 top-4 text-gray-400 group-focus-within:text-indigo-400 transition"></i>
        <input 
          id="linkStory" 
          type="url" 
          pattern="https?://.+" 
          class="peer w-full p-3 pl-10 rounded-xl outline-none transition duration-300 
                 invalid:border-red-500 invalid:text-red-400 invalid:bg-red-900/20 focus:invalid:border-red-500 focus:invalid:ring-red-900/30" 
          placeholder="https://truyen... (N·∫øu c√≥)">
        
        <div class="hidden peer-invalid:flex items-center mt-2 text-sm text-red-300 bg-red-900/30 p-2 rounded-lg border border-red-800/50 animate-pulse">
          <i class="fa-solid fa-triangle-exclamation mr-2 text-lg"></i>
          <span>Link kh√¥ng h·ª£p l·ªá! Vui l√≤ng b·∫Øt ƒë·∫ßu b·∫±ng <b>http://</b> ho·∫∑c <b>https://</b></span>
        </div>
      </div>
    </div>
    
    <div class="flex flex-wrap items-center gap-6 bg-white/10 p-4 rounded-2xl border border-white/20">
      <span class="font-bold">Phi√™n b·∫£n:</span>
      <label class="cursor-pointer flex items-center gap-2 px-3 py-1 rounded-full hover:bg-blue-500/20 transition"><input type="radio" name="version" value="Edit" class="accent-indigo-500 w-4 h-4" required> <span class="text-blue-300 font-semibold">Edit</span></label>
      <label class="cursor-pointer flex items-center gap-2 px-3 py-1 rounded-full hover:bg-orange-500/20 transition"><input type="radio" name="version" value="Convert" class="accent-pink-500 w-4 h-4"> <span class="text-orange-300 font-semibold">Convert</span></label>
    </div>
    
    <textarea id="note" class="w-full p-4 rounded-xl outline-none transition duration-300" rows="3" placeholder="Review ng·∫Øn / Note cho admin..."></textarea>
    
    <button class="py-4 btn-gradient text-lg font-bold uppercase tracking-wider transform hover:-translate-y-1"><i class="fa-solid fa-meteor mr-2"></i> G·ª≠i ngay</button>
  </form>
</section>

<section id="list" class="w-[95%] max-w-7xl mx-auto mt-24 p-6 sm:p-10 glass floating-delayed" data-aos="fade-up">
  <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
    <h2 class="text-3xl font-bold flex items-center gap-2">
      <span class="bg-indigo-900/50 p-2 rounded-lg text-indigo-300"><i class="fa-solid fa-layer-group"></i></span>
      Kho T√†ng
    </h2>
    <div class="flex gap-3 w-full md:w-auto bg-white/10 p-1.5 rounded-full shadow-inner border border-white/20">
      <input id="searchInput" class="bg-transparent p-2 px-4 w-full md:w-64 focus:outline-none text-gray-200 placeholder-gray-500" placeholder="üîç T√¨m ki·∫øm..." onkeyup="filterStories()">
      <select id="sortSelect" class="bg-black/50 rounded-full px-4 py-2 text-sm font-semibold text-gray-300 focus:outline-none hover:bg-black/70 cursor-pointer transition shadow-sm" onchange="filterStories()">
        <option value="vote">üî• Hot Vote</option>
        <option value="new">‚è∞ M·ªõi nh·∫•t</option>
      </select>
    </div>
  </div>

  <div id="loadingList" class="loader"></div>
   
  <div class="hidden md:block overflow-hidden rounded-2xl shadow-lg border border-white/20">
    <table class="w-full text-left border-collapse">
      <thead class="bg-gradient-to-r from-indigo-900 to-purple-900 text-white h-14">
        <tr><th class="p-4 pl-6">T√™n truy·ªán</th><th>Phi√™n b·∫£n</th><th>Ghi ch√∫</th><th class="text-center">Y√™u th√≠ch</th><th class="p-4 text-center">ƒê·ªçc</th></tr>
      </thead>
      <tbody id="storyList" class="bg-black/20 backdrop-blur-sm divide-y divide-white/10"></tbody>
    </table>
  </div>

  <div id="storyListMobile" class="md:hidden space-y-5"></div>
</section>

<section id="reading" class="w-[95%] max-w-5xl mx-auto mt-24 p-8 glass mb-24" data-aos="fade-up">
  <h2 class="text-3xl font-bold text-center mb-8"><i class="fa-solid fa-podcast text-green-400 animate-bounce"></i> ƒêang L√™n S√≥ng</h2>
  <div id="readingList" class="grid sm:grid-cols-2 gap-6"></div>
</section>

<section id="admin" class="hidden w-[95%] max-w-7xl mx-auto mt-10 mb-10 p-6 bg-white rounded-xl shadow-2xl border-2 border-red-100 text-gray-800">
  <div class="flex justify-between items-center mb-6 border-b pb-4">
    <h2 class="text-2xl font-bold text-red-600">üõ°Ô∏è Admin Control</h2>
    <button class="px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-black transition" id="logoutBtn">Tho√°t</button>
  </div>
  <div class="overflow-x-auto">
    <table class="w-full text-center table-auto">
      <thead class="bg-gray-100 text-gray-600"><tr><th class="p-3">T√™n</th><th>TT</th><th>Link</th><th>H√†nh ƒë·ªông</th></tr></thead>
      <tbody id="adminTable" class="text-sm"></tbody>
    </table>
  </div>
</section>

<footer class="glass mt-10 p-6 text-center">
  <p class="font-semibold">¬© 2025 H·ªìi √Çm ƒêam M·ªπ <br> <span class="text-xs text-gray-400 font-normal">Made with <i class="fa-solid fa-heart text-red-500 animate-ping"></i> in the Galaxy</span></p>
</footer>

<script>
AOS.init({ once: true, offset: 100, duration: 800, easing: 'ease-out-cubic' });

const SUPABASE_URL='https://xklmcebwxkqbotqexprn.supabase.co';
const SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhrbG1jZWJ3eGtxYm90cWV4cHJuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2MzM1NDEsImV4cCI6MjA3OTIwOTU0MX0.vZj-5C_HhVgemG0LOTH3axf4P0bxXngzeQ3PSo93-m4';
const TABLE='stories';
let stories=[];

async function fetchStories(){
  document.getElementById('loadingTop').style.display='block';
  document.getElementById('loadingList').style.display='block';
  try {
    const res=await fetch(`${SUPABASE_URL}/rest/v1/${TABLE}?select=*`,{headers:{apikey:SUPABASE_KEY,Authorization:`Bearer ${SUPABASE_KEY}`}});
    if(!res.ok) throw new Error('Err');
    stories=await res.json();
    refresh();
  } catch(e) { Swal.fire('L·ªói k·∫øt n·ªëi', 'Vui l√≤ng t·∫£i l·∫°i trang', 'error'); }
  finally {
    document.getElementById('loadingTop').style.display='none';
    document.getElementById('loadingList').style.display='none';
  }
}

async function addStory(s){
  Swal.fire({title:'ƒêang g·ª≠i t√≠n hi·ªáu...',didOpen:()=>{Swal.showLoading()}});
  const res=await fetch(`${SUPABASE_URL}/rest/v1/${TABLE}`,{method:'POST',headers:{'Content-Type':'application/json',apikey:SUPABASE_KEY,Authorization:`Bearer ${SUPABASE_KEY}`,Prefer:'return=representation'},body:JSON.stringify(s)});
  if(res.ok){
    const data=await res.json();stories.push(data[0]);refresh();
    Swal.fire({icon:'success',title:'ƒê√£ g·ª≠i!',text:'C·∫£m ∆°n b·∫°n ƒë√£ ƒë√≥ng g√≥p cho v≈© tr·ª• ƒëam m·ªπ.',confirmButtonColor:'#764ba2'});
  } else Swal.fire('L·ªói','Kh√¥ng g·ª≠i ƒë∆∞·ª£c','error');
}

async function updateStory(id,d){
  await fetch(`${SUPABASE_URL}/rest/v1/${TABLE}?id=eq.${id}`,{method:'PATCH',headers:{'Content-Type':'application/json',apikey:SUPABASE_KEY,Authorization:`Bearer ${SUPABASE_KEY}`},body:JSON.stringify(d)});
  fetchStories();
}

async function deleteStory(id){
  const cf=await Swal.fire({title:'X√≥a kh·ªèi v≈© tr·ª•?',text:"Kh√¥ng th·ªÉ kh√¥i ph·ª•c ƒë√¢u nh√©!",icon:'warning',showCancelButton:true,confirmButtonColor:'#d33',confirmButtonText:'X√≥a lu√¥n'});
  if(cf.isConfirmed){
    await fetch(`${SUPABASE_URL}/rest/v1/${TABLE}?id=eq.${id}`,{method:'DELETE',headers:{apikey:SUPABASE_KEY,Authorization:`Bearer ${SUPABASE_KEY}`}});
    stories=stories.filter(s=>s.id!==id);refresh();Swal.fire('ƒê√£ x√≥a!','','success');
  }
}

async function toggleVote(id){
  const key=`vote_${id}`,st=stories.find(s=>s.id===id);if(!st)return;
  let v=st.votes||0;
  const btn = document.querySelector(`.vote-btn-${id}`);
  
  if(localStorage.getItem(key)){
    localStorage.removeItem(key);v=Math.max(0,v-1);
    if(btn) btn.classList.remove('text-red-500', 'scale-125');
  } else {
    localStorage.setItem(key,'true');v++;
    if(btn) {
      btn.classList.add('text-red-500');
      btn.style.transform = "scale(1.4)";
      setTimeout(()=>btn.style.transform="scale(1)", 300);
    }
  }
  st.votes=v; refresh(false);
  await updateStory(id,{votes:v});
}
function userVoted(id){return localStorage.getItem(`vote_${id}`);}

document.getElementById('formSuggest').addEventListener("submit",e=>{
  e.preventDefault();
  const s={
    title:document.getElementById('title').value.trim(),
    linkstory:document.getElementById('linkStory').value.trim(),
    version:document.querySelector('input[name="version"]:checked')?.value||'',
    note:document.getElementById('note').value.trim(),
    votes:0,status:'ƒë·ªÅ‚ÄØxu·∫•t',youtubelink:'',createdat:new Date().toISOString()
  };
  addStory(s);e.target.reset();
});

function refresh(fullRender = true){
  if(fullRender) { filterStories(); renderReading(); renderAdmin(); }
  else { 
    document.querySelectorAll('[id^="vote-count-"]').forEach(el => {
      const id = el.id.split('-')[2];
      const s = stories.find(x => x.id == id);
      if(s) el.innerText = s.votes;
    });
  }
}

function filterStories(){
  const keyword = document.getElementById('searchInput').value.toLowerCase();
  const sortMode = document.getElementById('sortSelect').value;
  let list = stories.filter(s => s.status === 'ƒë·ªÅ‚ÄØxu·∫•t' && s.title.toLowerCase().includes(keyword));
  if(sortMode === 'vote') list.sort((a,b) => b.votes - a.votes);
  else if(sortMode === 'new') list.sort((a,b) => new Date(b.createdat) - new Date(a.createdat));

  renderTop(list);
  renderListPC(list);
  renderListMobile(list);
}

function renderTop(list){
  const c=document.getElementById('topStories');c.innerHTML='';
  const top = [...list].sort((a,b)=>b.votes-a.votes).slice(0,3);
  if(top.length===0) c.innerHTML='<p class="text-gray-400 italic">V≈© tr·ª• ƒëang im l·∫∑ng...</p>';
   
  top.forEach((s,i)=>{
    let medal = i===0 ? 'ü•á' : (i===1 ? 'ü•à' : 'ü•â');
    let colorClass = i===0 ? 'border-yellow-500/50 shadow-yellow-500/20' : (i===1 ? 'border-gray-400/50 shadow-gray-400/20' : 'border-orange-500/50 shadow-orange-500/20');
    c.innerHTML+=`
    <div class="relative w-72 p-6 bg-white/10 backdrop-blur-md rounded-3xl shadow-xl border-2 ${colorClass} transform hover:-translate-y-3 transition duration-500 group" data-aos="flip-left" data-aos-delay="${i*100}">
      <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 text-5xl drop-shadow-md z-10">${medal}</div>
      <div class="mt-6 text-center">
        <h5 class="font-extrabold text-xl text-white mb-2 line-clamp-2 leading-tight group-hover:text-indigo-300 transition">${s.title}</h5>
        <div class="w-10 h-1 bg-white/30 mx-auto rounded mb-3"></div>
        <p class="text-xs text-gray-300 mb-4 bg-white/5 p-2 rounded-lg italic border border-white/10 min-h-[40px] flex items-center justify-center">"${s.note||'Ch∆∞a c√≥ review'}"</p>
        <div class="flex justify-between items-center bg-black/30 p-2 rounded-full shadow-inner">
          <span class="text-pink-400 font-bold text-sm px-2"><i class="fa-solid fa-heart animate-pulse"></i> ${s.votes}</span>
          ${s.linkstory ? `<a href="${s.linkstory}" target="_blank" class="bg-indigo-600 text-white w-8 h-8 rounded-full flex items-center justify-center hover:bg-indigo-700 transition shadow-lg shadow-indigo-500/50"><i class="fa-solid fa-arrow-right"></i></a>` : ''}
        </div>
      </div>
    </div>`;
  });
}

function renderListPC(list){
  const tb=document.getElementById('storyList');tb.innerHTML='';
  list.forEach((s, index)=>{
    tb.innerHTML+=`
    <tr class="table-row-anim border-b border-white/10" data-aos="fade-up" data-aos-delay="${index * 50}">
      <td class="p-4 pl-6 font-semibold text-white">
        <div class="flex flex-col">
          <a href="${s.linkstory||'#'}" target="_blank" class="hover:text-indigo-300 transition text-lg">${s.title}</a>
          ${s.createdat && ((new Date()-new Date(s.createdat))/(1000*3600*24)<3) ? '<span class="text-[10px] font-bold text-green-400 uppercase tracking-wider flex items-center gap-1"><span class="w-1.5 h-1.5 bg-green-400 rounded-full animate-ping"></span> M·ªõi tinh</span>':''}
        </div>
      </td>
      <td class="p-4"><span class="px-3 py-1 rounded-full text-xs font-bold border ${s.version==='Edit'?'bg-blue-900/30 text-blue-300 border-blue-500/30':'bg-orange-900/30 text-orange-300 border-orange-500/30'}">${s.version}</span></td>
      <td class="p-4 text-sm text-gray-300 italic whitespace-normal break-words align-top leading-relaxed">${s.note||'-'}</td>
      <td class="p-4 text-center">
        <button onclick="toggleVote(${s.id})" class="vote-btn-${s.id} transition transform active:scale-90 ${userVoted(s.id)?'text-red-500':'text-gray-500 hover:text-red-400'}">
          <i class="fa-solid fa-heart text-2xl drop-shadow-sm"></i>
        </button>
        <div id="vote-count-${s.id}" class="text-xs font-bold mt-1 text-gray-400">${s.votes}</div>
      </td>
      <td class="p-4 text-center">
        ${s.linkstory ? `<a href="${s.linkstory}" target="_blank" class="text-indigo-400 hover:text-indigo-300 text-xl transition hover:rotate-12 inline-block"><i class="fa-solid fa-book-open-reader"></i></a>` : '<span class="text-gray-600"><i class="fa-solid fa-ban"></i></span>'}
      </td>
    </tr>`;
  });
}

function renderListMobile(list){
  const mb=document.getElementById('storyListMobile');mb.innerHTML='';
  list.forEach((s, index)=>{
    mb.innerHTML+=`
    <div class="bg-white/10 backdrop-blur-md p-5 rounded-2xl shadow-sm border border-white/20 flex justify-between items-start transform transition hover:scale-[1.02]" data-aos="fade-up" data-aos-delay="${index * 50}">
      <div class="flex-1 pr-3 text-white">
        <h4 class="font-bold text-lg mb-1 leading-tight">${s.title}</h4>
        <div class="flex items-center gap-2 mb-2">
          <span class="text-[10px] px-2 py-0.5 rounded border ${s.version==='Edit'?'bg-blue-900/30 text-blue-300 border-blue-500/30':'bg-orange-900/30 text-orange-300 border-orange-500/30'} font-bold">${s.version}</span>
          ${s.createdat && ((new Date()-new Date(s.createdat))/(1000*3600*24)<3) ? '<span class="text-[10px] text-green-400 font-bold border border-green-500/30 px-1 rounded bg-green-900/30">NEW</span>':''}
        </div>
        <p class="text-sm text-gray-300 mb-3 italic leading-relaxed text-justify">"${s.note||'...'}"</p>
        ${s.linkstory ? `<a href="${s.linkstory}" target="_blank" class="text-indigo-400 text-sm font-bold hover:underline flex items-center gap-1"><i class="fa-solid fa-book-reader"></i> ƒê·ªçc ngay</a>` : ''}
      </div>
      <div class="flex flex-col items-center justify-center pl-4 border-l border-white/10">
        <button onclick="toggleVote(${s.id})" class="vote-btn-${s.id} ${userVoted(s.id)?'text-red-500':'text-gray-500'} text-2xl mb-1 transition active:scale-75"><i class="fa-solid fa-heart"></i></button>
        <span id="vote-count-${s.id}" class="font-bold text-gray-400 text-sm">${s.votes}</span>
      </div>
    </div>`;
  });
}

function renderReading(){
  const list=stories.filter(s=>s.status==='ƒëang‚ÄØƒë·ªçc');
  const c = document.getElementById('readingList');
  if(list.length === 0) {
    c.innerHTML = '<div class="col-span-2 text-center text-gray-400 italic">Hi·ªán ch∆∞a c√≥ radio n√†o...</div>';
    return;
  }
  c.innerHTML=list.map((s,i)=>`
    <a href="${s.youtubelink}" target="_blank" class="flex items-center p-4 bg-white/10 rounded-2xl shadow-md hover:shadow-xl transition transform hover:-translate-y-1 group border border-white/20" data-aos="zoom-in" data-aos-delay="${i*100}">
      <div class="relative w-14 h-14 mr-4">
         <div class="absolute inset-0 bg-green-500 rounded-full opacity-20 animate-ping"></div>
         <div class="relative bg-gradient-to-br from-green-500 to-teal-600 text-white w-14 h-14 rounded-full flex items-center justify-center shadow-lg group-hover:rotate-12 transition duration-500"><i class="fa-solid fa-play ml-1"></i></div>
      </div>
      <div class="flex-1 overflow-hidden text-white">
        <h4 class="font-bold truncate group-hover:text-green-400 transition">${s.title}</h4>
        <div class="flex items-center gap-2 mt-1">
           <span class="w-10 h-0.5 bg-white/30 overflow-hidden"><div class="h-full bg-green-500 animate-[loading_2s_ease-in-out_infinite] w-1/2"></div></span>
           <p class="text-xs text-gray-400">ƒêang ph√°t</p>
        </div>
      </div>
    </a>`).join('');
}
</script>
</body>
</html>
